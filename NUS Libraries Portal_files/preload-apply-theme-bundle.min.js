(function () {
  var background = localStorage.getItem('show-background') || 'true';
  var theme = localStorage.getItem('theme') || 'default';
  var fontsize = localStorage.getItem('font-size') || '16px';
  var className = '';

  if (background !== 'true') {
    className += ' no-background';
  }

  if (theme === 'monochrome') {
    className += ' monochrome';
  }

  if (fontsize !== '16px') {
    document.getElementsByTagName('html')[0].style.fontSize = fontsize;
  }

  document.documentElement.setAttribute('class', className);

  if (theme === 'dark') {
    document.getElementById('main-style').disabled = true;
    document.getElementById('dark-style').disabled = false;

    // var oldLinkCss = document.getElementById('main-style');
    // var cssFile = oldLinkCss.getAttribute('href');
    // var cssOther = oldLinkCss.getAttribute('other-style');

    // var newLinkCss = document.createElement('link');
    // newLinkCss.setAttribute("rel", "stylesheet");
    // newLinkCss.setAttribute("type", "text/css");
    // newLinkCss.setAttribute("id", "main-style")
    // newLinkCss.setAttribute("other-style", cssFile);
    // newLinkCss.setAttribute("href", cssOther);

    // document.getElementsByTagName("head").item(0).replaceChild(newLinkCss, oldLinkCss);
  }

  document.addEventListener('DOMContentLoaded', function (event) {
    document.getElementsByTagName('body')[0].style.fontSize = fontsize;

    document.getElementById('setting-background').checked = background === 'true';
    document.getElementById('setting-background-mobile').checked = background === 'true';

    document.getElementById('setting-color').checked = theme === 'monochrome';
    document.getElementById('setting-color-mobile').checked = theme === 'monochrome';

    document.getElementById('setting-dark').checked = theme === 'dark';
    document.getElementById('setting-dark-mobile').checked = theme === 'dark';

    if (theme === 'dark') {
      $('header .logo img').each(function () {
        var src = $(this).attr('src');
        var othersrc = $(this).data('other-src');
        if (othersrc) {
          $(this).data('other-src', src);
          $(this).attr('src', othersrc);
        }
      });
    }
  });
})();
